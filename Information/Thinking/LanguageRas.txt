Задача: Функции

ПризнакСреза(строка Sost)[Name='Формирует признак среза']
  = Если(ВремяТочки(Sost)<=НачалоПериода,'Срез','');
  
ВремяМс(Время T)[Name='Переводит время в строку с указанием милисекунд']
  ms=ЧастьВремени('мс', T)
  = ДобавитьКоВремени('мс', T, -ms) + ',' +  StrRight(Строка(1000+ms), 3);
  
SostStr(целое Sost, строка TablCode, целое TablNum=1, целое BitsCount=16) 
 [Name='Расшифровка одного слова состояния']
  St='' i=0
  Пока(i<BitsCount, 
       BitVal=Бит(Sost;i)
       Если(BitVal And ПодТаблСодержит(TablNum;TablCode;I;0),  
         St=St + ВзятьПодТабл(TablNum;TablCode;I;0)+ ';')
       i=i+1)
  = St;
  
Мгновенные ДобавитьСрез(строка S) 
 [Name='Добавляет к значению признак среза'] 
  = S
  Мгновенные Срез = 
   [Name='Признак среза']
   ПризнакСреза(Владелец);
   
СостТЗ(целое Sost) [Name='Состояние ТЗ для ведомости'] 
  = SostStr(Sost;'ТЗ_1');

  
Задача: ВТЗ 

Мгновенные ВТЗВТЗ (СигналДискр ВТЗ)
  [Name='Функция задачи ВТЗ для одной ВТЗ']
  = ВТЗ
  Мгновенные Код = ВТЗ.Code
  Мгновенные Приор = Табл(VTZTZ, PriorVTZ, КодВТЗ)
  Мгновенные Срез = ПризнакСреза(ВТЗ)
  Мгновенные СостСтр = Если(ВТЗ; 'Сработала'; '')
  Мгновенные КолСраб = Количество(ВТЗ);
  
Генерация ВТЗ : VTZTZ 
  [ToIdent(Code)+ '_СрабВТЗ'] [Name=NameVTZ]
   = ВТЗВТЗ([Объект(Code)]);


Задача: ТЗ

Генерация ТЗ : TZ
  Мгновенные [ToIdent(Code)+ '_Срез'] 
    [Name=NameTZ]
	= ДобавитьСрез(СостТЗ([Объект(Code)]));


Задача: РАС

Мгновенные РАСВТЗ (СигналДискр ВТЗ, строка ТЗСост, строка ТЗКод, строка ТЗИмя)
 [Name='Задача РАС для одной ВТЗ']
  = СдвигПоВремени(Событие(1;ВТЗ);0,0001)
  Мгновенные КодВТЗ = ВТЗ.Code
  Мгновенные ПриорВТЗ = ВзятьТабл(VTZTZ;КодВТЗ;0)
  Мгновенные ПриорВТЗточка = ЗначениеПоТочкам(ПриорВТЗ;ПервСост)
  Мгновенные ПервКод = ЗначениеПоНомеру(1;ТЗКод;СегментыОтТочек(Владелец;-1))
  Мгновенные ПервИмя = ЗначениеПоНомеру(1;ТЗИмя;СегментыОтТочек(Владелец;-1))
  Мгновенные ПервВрем = ВремяТочки(ПервКод)
  Мгновенные ПервВремСтр = ВремяМс(ПервВрем)
  Мгновенные ПервСост = ЗначениеПоНомеру(1;ТЗСост;СегментыОтТочек(Владелец;-1))
  Мгновенные ПервСостСтр = SostStr(ПервСост;'ТЗ_1')
  Мгновенные ПризнВремАвар = -1*(АВАРИЯ.ВремяАварии == ПервВрем);
  
Генерация РАС : VTZTZ(UnitTypeVTZ=='ВТЗ')
  [ToIdent(Code)+ '_РАС'] [Name=NameVTZ] 
  ТЗИмя = Объединить([GenSubTabl(UnitTypeTZ=='ТЗ', 'Событие(\'' + NameTZ + '\', Бит(' + Объект(Code) + ', 14)), ', '') 
                      GenSubTabl(UnitTypeTZ=='ВТЗ', 'Событие(\'' + NameTZ + '\',' + Объект(Code) + ')', '')] 
			   	      БезТочек)
  ТЗКод = Объединить([GenSubTabl(UnitTypeTZ=='ТЗ', 'Событие(\'' + Code + '\', Бит(' + Объект(Code) + ', 14)), ', '') 
                      GenSubTabl(UnitTypeTZ=='ВТЗ', 'Событие(\'' + Code + '\',' + Объект(Code) + ')', '')] 
			   	      БезТочек)
  ТЗСост = Объединить([GenSubTabl(UnitTypeTZ=='ТЗ', 'Событие(' + Объект(Code), Бит(' + Объект(Code) + ', 14)), ', '') 
                      GenSubTabl(UnitTypeTZ=='ВТЗ', 'Событие(' + Объект(Code), Объект(Code) + ')', '')] 
			   	      БезТочек)  
  = РАСВТЗ([Объект(Code)], ТЗСост, ТЗКод, ТЗИмя);
  
	
Задача: Аналоговые сигналы

Мгновенные AnalogValues(действ Par) 
 [Name='Функция для аналоговых ведомостей']
  = Par
  Мгновенные Срез = ПризнакСреза(Par);
  
Генерация Analog : Analog
  Мгновенные [ToIdent(Code)] 
   [Name=NameUnit]
   = AnalogValues([Объект(Code)]);
   
  











